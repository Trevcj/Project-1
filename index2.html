<!DOCTYPE html>
<html>
<head>
	<title>Travel-Weather API</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="assets/css/style.css">
<!-- 	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC5txE1u5FB5GQ8UWshthJYQ8eUGfKXisg" type="text/javascript"></script> -->
	<!-- <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC5txE1u5FB5GQ8UWshthJYQ8eUGfKXisg"></script> -->
	<script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
 	<script type="text/javascript" src="assets/javascript/epolyv3.js"></script> 
</head>
<body>

	<div class="jumbotron jumbotron-fluid">
		  <div class="container">
		    <h1 class="display-3">Travel-Weather API</h1>
		    <h5>Use this app to display the weather on your route.</h5>
		  </div>
		</div>
	<div class="container">

		
		<div class="container-fluid">
			<div class="row content">
			    <div class="col-sm-3 sidenav">
			    	<div class="card">
			    		<div class="card-header">
					    <h3 id="smallHeader">Search Parameters:</h3>
					  	</div>
					  	<div class="card-body">
					      	<form>
							  <div class="form-group">
							    <label>Starting Location</label>
							    <input id="startLocation" type="text" class="form-control" name="search" placeholder="">
							    
							  </div>
								<h4 id="center">-To-</h4>
							  <div class="form-group">
							    <label>End Location</label>
							    <input id="endLocation" type="text" class="form-control" name="search" placeholder="">
							    
							  </div>
							  <div class="form-group">
							    <label>Display Weather Every:</label>
							    <select class="form-control" id="mileValue">
							      <option value="25">25 Miles</option>
							      <option value="50">50 Miles</option>
							      <option value="100">100 Miles</option>			     
							    </select>
							  </div>
							  
							</form>
							<button type="submit" class="btn btn-default" id="runSearch"><i class="fa fa-search"></i> Search</button>
						</div>
					</div>
			    </div>

			    <div class="col-sm-9">			    	
					<div id="map" style="width:400px;height:400px;">
					</div>			      
			    </div>

			</div>
		</div>
			<div class="col">
			    	<div id="weatherbox" class="card">
					  <div  class="card-header">
					    <h3 id="smallHeader">More Info:</h3>
					  </div>
					  <div id="detailedWeather" class="card-body">
					  	<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed id ante nisi. Cras ante justo, laoreet eu ullamcorper vitae, fermentum malesuada diam. Curabitur semper odio ut ultricies dictum. Sed vitae nisi a sapien malesuada eleifend. Etiam lacinia quam ut tellus accumsan tincidunt. Aenean eleifend blandit dignissim. Morbi laoreet erat turpis, in imperdiet eros finibus vitae. Donec ac placerat nunc, ut vestibulum dui. Cras pretium, magna in aliquet pellentesque, augue massa ornare ex, ut molestie nibh justo eget nisl. Aliquam efficitur id est nec consequat. Nulla dui mi, blandit et purus quis, placerat consequat nisl. Phasellus sed pulvinar massa, ut dapibus libero. Nullam sed libero lacus.</p>

						<p>Sed ac sem in diam vulputate dapibus. Vivamus vestibulum libero at lectus suscipit, non sodales massa convallis. Nullam vel tristique tellus. Morbi efficitur massa fringilla lorem efficitur fringilla. Nulla laoreet eros sed orci eleifend accumsan. Suspendisse porttitor nisl vitae arcu tristique, vel aliquet nunc cursus. Vivamus sapien sapien, tempus accumsan sem vitae, sodales luctus risus. Donec id sem vel felis posuere volutpat a et nunc. Quisque gravida ante eget dui mollis eleifend. Etiam vitae ligula sed risus feugiat cursus sed ut metus. Nunc ac aliquam tellus. Nam id tincidunt ipsum. Suspendisse nisl nisl, ullamcorper ac rhoncus ac, tempus at odio. Praesent in feugiat augue. Duis in laoreet lectus.</p>

						<p>Maecenas vehicula auctor tempus. Duis ac metus ligula. Sed pretium, turpis ac commodo imperdiet, mauris ante imperdiet dolor, ut lacinia justo nisl vitae elit. Cras pretium augue non justo tincidunt, eget fringilla sem ultricies. Duis rutrum, elit vitae iaculis sagittis, lacus justo luctus leo, sed posuere mauris enim sed magna. Nam ullamcorper nisl nulla, eu blandit urna accumsan sit amet. Aenean commodo eu eros vitae dictum. Sed eget orci ut justo congue vulputate. Ut eleifend orci non leo pharetra imperdiet. Cras sollicitudin tortor tortor, ac sollicitudin ex rutrum ut. Vestibulum eget interdum nisl. Aliquam euismod augue laoreet ligula varius scelerisque.</p>

											    
					  </div>
					</div>			      
			   </div>
		

	</div>
	

	<footer class="container-fluid">
	  <h3>&copy; Alan, Perla, Darwood, Trevor</h3>
	</footer>

	   	<script>

		   	var startLocation;
		   	var endLocation;
		   	var mileValue;
		   	var polyline = null;
			var gmarkers = [];

		    function initMap() {
		        var directionsService = new google.maps.DirectionsService;
		        var directionsDisplay = new google.maps.DirectionsRenderer;
		        var map = new google.maps.Map(document.getElementById('map'), {
		          zoom: 7,
		          center: {lat: 39.50, lng: -98.35}
		        });
				polyline = new google.maps.Polyline({
				    path: [],
				    strokeColor: '#FF0000',
				    strokeWeight: 3
				});

		        directionsDisplay.setMap(map);

		        function onChangeHandler() {
		        	console.log("Sending "+ startLocation);
		        	console.log("Sending "+ endLocation);
		          	calculateAndDisplayRoute(directionsService, directionsDisplay);
		        };

		        $("#runSearch").on("click", function(event){
		        	event.preventDefault();
		        	startLocation = $("#startLocation").val().trim();
		        	endLocation = $("#endLocation").val().trim();
		        	onChangeHandler();
				});
		    }

	    function calculateAndDisplayRoute(directionsService, directionsDisplay) {
		  	var waypts = [];
		  	var checkboxArray = document.getElementsByClassName('waypoints');
		  	for (var i = 0; i < checkboxArray.length; i++) {
		    	var address = checkboxArray[i].value;
		    	if (address != '') {
		      		waypts.push({
		        		location: checkboxArray[i].value,
		        		stopover: true
		      		});
		   		}
			}

	        directionsService.route({
	         	origin: document.getElementById('startLocation').value,
	         	waypoints: waypts,
	        	destination: document.getElementById('endLocation').value,
	        	travelMode: 'DRIVING'
	        }, function(response, status) {
	          	if (status == google.maps.DirectionsStatus.OK) {
	          	polyline.setPath([]);
	          	var bounds = new google.maps.LatLngBounds();
	          	startLocation = new Object();
	          	endLocation = new Object();
	            directionsDisplay.setDirections(response);
	            var route = response.routes[0];

	            //Summary information for each route
	            var path = response.routes[0].overview_path;
	            var legs = response.routes[0].legs;
	          	for (i = 0; i < legs.length; i++) {
        			if (i == 0){ 
        				startLocation.latlng = legs[i].start_location;
          				startLocation.address = legs[i].start_address;
          				marker = createMarker(legs[i].start_location, "start", legs[i].start_address, "green");
          				}
				        endLocation.latlng = legs[i].end_location;
				        endLocation.address = legs[i].end_address;
				        var steps = legs[i].steps;
				        for (j = 0; j < steps.length; j++) {
				          	var nextSegment = steps[j].path;
				          	for (k = 0; k < nextSegment.length; k++) {
				            	polyline.getPath().push(nextSegment[k]);
				            	bounds.extend(nextSegment[k]);
				          	}
				        }
			    	}

			        polyline.setMap(map);
				    for (var i=0; i<gmarkers.length; i++) {
				    	gmarkers[i].setMap(null);
				    }
				    gmarkers = [];
				    var points = polyline.GetPointsAtDistance(1609.34 * mileValue);
				    for (var i=0; i<points.length; i++) {
				    	var marker = new google.maps.Marker({
				    		map: map, 
				    		position: points[i],
				    		title: i+1+" mile"
				    	});
				    	marker.addListener('click', openInfoWindow);
				    	gmarkers.push(marker);
				    }
	          	} else {
	            	alert('Request failed due to ' + status);
	          	}
	        });
	    }
	    google.maps.event.addDomListener(window, 'load', initMap);

	    function createMarker(latlng, label, html, color) {
		  // alert("createMarker("+latlng+","+label+","+html+","+color+")");
			var contentString = '<b>' + label + '</b><br>' + html;
			var marker = new google.maps.Marker({
		    	position: latlng,
		    // draggable: true, 
		    	map: map,
		    	icon: getMarkerImage(color),
		    	title: label,
		    	zIndex: Math.round(latlng.lat() * -100000) << 5
		  	});
		  	marker.myname = label;
		  	gmarkers.push(marker);

		  	google.maps.event.addListener(marker, 'click', function() {
		  		infowindow.setContent(contentString);
		  		infowindow.open(map, marker);
		  	});
		  	return marker;
		}

		function openInfoWindow() {
			var contentString = this.getTitle()+"<br>"+this.getPosition().toUrlValue(6);
			infowindow.setContent(contentString);
			infowindow.open(map, this);
		}
		var icons = new Array();
		icons["red"] = {url: "http://maps.google.com/mapfiles/ms/micons/red.png"};

		function getMarkerImage(iconColor) {
			if ((typeof(iconColor)=="undefined") || (iconColor==null)) {
				iconColor = "red";
			}
			if (!icons[iconColor]) {
				icons[iconColor] = {url:"http://maps.google.com/mapfiles/ms/micons/"+ iconColor +".png"};
			}
			return icons[iconColor];
		}

    	</script>
     <!-- <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC5txE1u5FB5GQ8UWshthJYQ8eUGfKXisg&callback=initMap"> </script> -->


</body>
</html>